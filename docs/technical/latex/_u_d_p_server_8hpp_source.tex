\doxysection{UDPServer.\+hpp}
\hypertarget{_u_d_p_server_8hpp_source}{}\label{_u_d_p_server_8hpp_source}\index{server/include/UDPServer.hpp@{server/include/UDPServer.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ Created\ by\ Xavier\ VINCENT\ on\ 13/12/2023.}}
\DoxyCodeLine{00003\ \textcolor{comment}{//}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ "{}RTypeNetwork.hpp"{}}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00017\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_timed_message}{TimedMessage}}\ \{}
\DoxyCodeLine{00018\ \ \ \mbox{\hyperlink{struct_message}{Message}}\ *\mbox{\hyperlink{struct_timed_message_a2c1d25c80436512087308a036f01e86a}{message}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00019\ \ \ std::chrono::high\_resolution\_clock::time\_point\ \mbox{\hyperlink{struct_timed_message_abd5fd4e205672e1fdd572a47e7736e67}{timestamp}};\ }
\DoxyCodeLine{00020\ \};}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{keyword}{namespace\ }Network}
\DoxyCodeLine{00023\ \{}
\DoxyCodeLine{00032\ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_network_1_1_u_d_p_server}{UDPServer}}\ \{}
\DoxyCodeLine{00033\ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00044\ \ \ \ \ \mbox{\hyperlink{class_network_1_1_u_d_p_server}{UDPServer}}(boost::asio::io\_context\ \&io);}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00058\ \ \ \ \ \mbox{\hyperlink{class_network_1_1_u_d_p_server}{UDPServer}}(boost::asio::io\_context\ \&io,\ \textcolor{keywordtype}{int}\ port);}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00066\ \ \ \ \ \mbox{\hyperlink{class_network_1_1_u_d_p_server_a6ae6efb6b05e6b6518195512e90a216d}{\string~UDPServer}}();}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00076\ \ \ \ \ boost::asio::ip::udp::socket\ \&\mbox{\hyperlink{class_network_1_1_u_d_p_server_ac32cc82757d28952e4429a16189b4216}{getSocket}}();}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00086\ \ \ \ \ std::vector<Network::Client>\ \&\mbox{\hyperlink{class_network_1_1_u_d_p_server_a6577105fddee863d8d7bbae6f7bac2f7}{getClients}}();}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00095\ \ \ \ \ \mbox{\hyperlink{class_network_1_1_client}{Network::Client}}\ \&\mbox{\hyperlink{class_network_1_1_u_d_p_server_ac53887abfffcb234eb820f6beb7c58ff}{getClientById}}(\textcolor{keywordtype}{int}\ \textcolor{keywordtype}{id});}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00105\ \ \ \ \ boost::array<char,\ 65536>\ \mbox{\hyperlink{class_network_1_1_u_d_p_server_abc40e08966da73a1b12d380a0dce6053}{getRecvBuffer}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00116\ \ \ \ \ boost::asio::ip::udp::endpoint\ \mbox{\hyperlink{class_network_1_1_u_d_p_server_a9f7a52213bf27b1cd095cf526d6736ac}{getRemoteEndpoint}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00126\ \ \ \ \ std::vector<Network::Room>\ \&\mbox{\hyperlink{class_network_1_1_u_d_p_server_a421b82239515eafa196dc68cc573fc2b}{getRooms}}();}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00136\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{class_network_1_1_u_d_p_server_a2c13629ee0ccbf4d9b12deb117080603}{getNextClientIdAndIncrement}}();}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_network_1_1_u_d_p_server_abdff6274a3af6cd99c418197c4630a75}{addClient}}(\mbox{\hyperlink{class_network_1_1_client}{Network::Client}}\ client);}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_network_1_1_u_d_p_server_a8d43c1630c01f9eefa4909772057e9c8}{initServer}}(\textcolor{keywordtype}{int}\ port);}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00165\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_network_1_1_u_d_p_server_ac4b4c1cd19635deb604ceb2a63839f4d}{initRooms}}(\textcolor{keywordtype}{int}\ count);}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00172\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_network_1_1_u_d_p_server_ac2a6fa9962f244fd7ba8578d89296874}{startReceive}}();}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00180\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_network_1_1_u_d_p_server_ac97d512d745687229613d23b27a71bae}{handleReceive}}(boost::system::error\_code\ \textcolor{keyword}{const}\ \&error,\ std::size\_t\ bytes\_transferred);}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00190\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_network_1_1_u_d_p_server_a4928e7aa98d5e037872d25cff45c9f8a}{updateClientLastMessageTimeFromData}}(\textcolor{keywordtype}{char}\ *data);}
\DoxyCodeLine{00191\ }
\DoxyCodeLine{00199\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_network_1_1_u_d_p_server_ac811ac0c540ab08eeb7fd4002e4af9d4}{sendToAll}}(boost::asio::const\_buffer\ \textcolor{keyword}{const}\ \&buffer);}
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00211\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_network_1_1_u_d_p_server_a9a296cd50ace6d20256e4a94290bf1b4}{sendToAllClientsInRoom}}(boost::asio::const\_buffer\ \textcolor{keyword}{const}\ \&buffer,\ \textcolor{keywordtype}{int}\ roomId);}
\DoxyCodeLine{00212\ }
\DoxyCodeLine{00223\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_network_1_1_u_d_p_server_a4c3186c7dcf335536c43e4d1564ee0e0}{sendToAllClientsInRoomInGame}}(boost::asio::const\_buffer\ \textcolor{keyword}{const}\ \&buffer,\ \textcolor{keywordtype}{int}\ roomId);}
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00234\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_network_1_1_u_d_p_server_a9c2f0877b54c60de4ca0a2d21696ba93}{sendToClient}}(boost::asio::const\_buffer\ \textcolor{keyword}{const}\ \&buffer,\ \textcolor{keywordtype}{int}\ \textcolor{keywordtype}{id});}
\DoxyCodeLine{00235\ }
\DoxyCodeLine{00244\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_network_1_1_u_d_p_server_a7d721dae9793f447e2199f8780096e53}{handleSend}}(boost::system::error\_code\ \textcolor{keyword}{const}\ \&error,\ std::size\_t\ bytesTransferred);}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00252\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_network_1_1_u_d_p_server_ad31c0be7001a0123b1fe8434161665de}{processMessage}}(\mbox{\hyperlink{struct_timed_message}{TimedMessage}}\ message);}
\DoxyCodeLine{00253\ }
\DoxyCodeLine{00262\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_network_1_1_u_d_p_server_a16bd0e5a013230d835b30a3b0cfd86d9}{processResponse}}(\mbox{\hyperlink{struct_response}{Response}}\ *response);}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00271\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_network_1_1_u_d_p_server_aabec654d8576481b31d0c1e689b66699}{workerFunction}}();}
\DoxyCodeLine{00272\ }
\DoxyCodeLine{00286\ \ \ \ \ std::vector<char>\ \mbox{\hyperlink{class_network_1_1_u_d_p_server_a4031d156ae82ff57038b16f3d214d781}{createMessageBuffer}}(}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ clientId,}
\DoxyCodeLine{00288\ \ \ \ \ \ \ std::string\ \textcolor{keyword}{const}\ \&command,}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ \textcolor{keyword}{const}\ data[]\ =\ \textcolor{keyword}{nullptr},}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ dataSize\ =\ 0);}
\DoxyCodeLine{00291\ }
\DoxyCodeLine{00307\ \ \ \ \ std::vector<char>\ \mbox{\hyperlink{class_network_1_1_u_d_p_server_a0a2583c36c354de1725dcfab25c5e14d}{createResponseBuffer}}(}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ clientId,}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \mbox{\hyperlink{struct_message_header}{MessageHeader}}\ \textcolor{keyword}{const}\ \&messageHeader,}
\DoxyCodeLine{00310\ \ \ \ \ \ \ std::string\ \textcolor{keyword}{const}\ \&statusMessage,}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ \textcolor{keyword}{const}\ data[]\ =\ \textcolor{keyword}{nullptr},}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ dataSize\ =\ 0,}
\DoxyCodeLine{00313\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ status\ =\ RES\_SUCCESS);}
\DoxyCodeLine{00314\ }
\DoxyCodeLine{00325\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_network_1_1_u_d_p_server_ae6df6365d9c49e58434876ef104817a9}{sendResponseAndLog}}(\mbox{\hyperlink{struct_timed_message}{TimedMessage}}\ timedMessage,\ std::vector<char>\ responseBuffer);}
\DoxyCodeLine{00326\ }
\DoxyCodeLine{00337\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_network_1_1_u_d_p_server_ab2d04421510f1fd72b2158aa171241e9}{isClientRegistered}}(\textcolor{keywordtype}{int}\ clientId);}
\DoxyCodeLine{00338\ }
\DoxyCodeLine{00346\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_network_1_1_u_d_p_server_a82f424a15da216aade28273353dad9eb}{registerCommandHandlers}}();}
\DoxyCodeLine{00347\ }
\DoxyCodeLine{00353\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_network_1_1_u_d_p_server_af9906b402d8c7af8b1b6f9d4332bb60c}{checkClientTimers}}();}
\DoxyCodeLine{00354\ }
\DoxyCodeLine{00360\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_network_1_1_u_d_p_server_ace11e347c4bfbad29bfe8d1cb6f2bba2}{startClientTimerCheck}}();}
\DoxyCodeLine{00361\ }
\DoxyCodeLine{00367\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_network_1_1_u_d_p_server_af419e1866cc5630292523ae901aa7c0f}{gameLoop}}();}
\DoxyCodeLine{00368\ }
\DoxyCodeLine{00379\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_network_1_1_u_d_p_server_ac1d3c03a7b8e6d002d8938e70fd4ba36}{notifyAndRemoveClient}}(\textcolor{keywordtype}{int}\ clientId);}
\DoxyCodeLine{00380\ }
\DoxyCodeLine{00389\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_network_1_1_u_d_p_server_a60ae214e6da64da40df29b14970b25a1}{sendCheckConnection}}(\textcolor{keywordtype}{int}\ clientId);}
\DoxyCodeLine{00390\ }
\DoxyCodeLine{00391\ \ \ \ \ std::mutex\ \mbox{\hyperlink{class_network_1_1_u_d_p_server_aef0ef5329ac37e03dd21cc4ea24b65db}{roomsMutex}};\ }
\DoxyCodeLine{00392\ }
\DoxyCodeLine{00393\ \ \ \ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00394\ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00395\ \ \ \ \ boost::asio::ip::udp::socket\ socket;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00396\ \ \ \ \ std::vector<Network::Client>\ clients;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00397\ \ \ \ \ boost::array<char,\ 65536>\ recvBuffer\ \{\};\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00398\ \ \ \ \ boost::asio::ip::udp::endpoint\ remoteEndpoint;\ \ \ \ \ \ \ }
\DoxyCodeLine{00399\ \ \ \ \ \mbox{\hyperlink{class_network_1_1_thread_safe_queue}{Network::ThreadSafeQueue<TimedMessage>}}\ messageQueue;\ }
\DoxyCodeLine{00400\ \ \ \ \ std::vector<std::thread>\ workers;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00401\ \ \ \ \ \textcolor{keywordtype}{int}\ nextClientId;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00402\ \ \ \ \ std::vector<Network::Room>\ rooms;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00403\ \ \ \ \ std::unordered\_map<std::string,\ std::unique\_ptr<ICommandHandler>>}
\DoxyCodeLine{00404\ \ \ \ \ \ \ commandHandlers;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00405\ \ \ \ \ boost::asio::steady\_timer\ clientsConnectionTimer;\ }
\DoxyCodeLine{00406\ }
\DoxyCodeLine{00407\ \ \ \ \ \textcolor{keywordtype}{void}\ handleInvalidClient(\mbox{\hyperlink{struct_timed_message}{TimedMessage}}\ timedMessage);\ \ }
\DoxyCodeLine{00408\ \ \ \ \ \textcolor{keywordtype}{void}\ handleInvalidCommand(\mbox{\hyperlink{struct_timed_message}{TimedMessage}}\ timedMessage);\ }
\DoxyCodeLine{00409\ \ \ \};}
\DoxyCodeLine{00410\ \}\ \textcolor{comment}{//\ namespace\ Network}}

\end{DoxyCode}
